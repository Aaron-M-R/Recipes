# Are 'Best' Recipes Really the Best?

### Introduction

Cooking recipes have been around for thousands of years, passed down from generations, and an important part of all cultures worldwide. Almost a quarter into the 21st century, there are so many recipes on the internet it's now impossible to decide what to use. Without the famous chefs' cookbooks of the past, most people are left to their own devices to investigate a recipe before trying it. **But how do we know which recipes to trust?**

Ratings are clearly designed to indicate quality of a recipe on most websites, but that doesn't mean there aren't any other important factors. People often use things like the number of steps, cooktime, and title of a recipe to gauge the quality of a recipe as well. While the quality of a recipe is subjective, we want to investigate the relationship between these different methods of detecting quality. Specifically, assuming ratings are a trusted measure of public approval, we would like to know if recipes that claim to be high quality using their title, are also enjoyed by the public more often. Is a recipe called 'Best Chocolate Cake Ever' likely to have a better rating than a recipe just called 'Chocolate Cake'?

Using <a href="https://www.kaggle.com/datasets/shuyangli94/food-com-recipes-and-user-interactions">kaggle.com</a> datasets originally sourced from <a href="https://www.food.com/">food.com</a>, we will investigate how indications of high quality (IHQ) in a recipe title, affects the ratings. There are two datasets: one for recipes and one for reviews. The recipes dataset has a row for every recipe (83,782 recipes) posted between 2008 and 2018. There's information such as recipe name, ID, preparation time, contributor ID, submission date, tags, nutrition information, number of steps, steps text, and description for every recipe. The ratings dataset has a row for every comment under a recipe (731,927 comments) from 2008 to 2018 and contains user ID, recipe ID, date of interaction, rating, and review text.

We're interested in classifying recipes containing IHQ in their titles to determine if this has a correlation with recipe ratings. Within this investigation we hope to discover some kind of relationship between IHQ and other recipe features. That is, does including superlative and self-praising language in a recipe title tell you anything about the recipe itself? In order to research this question and the more general relationship surrounding it, we'll first take a look at the ratings. Once we understand the distribution of ratings and its relationship with other features such as number of steps and ingredients, cooktime and nutrition, we can compare how IHQ fits into the equation.



### Cleaning and Exploratory Data Analysis

##### Data Wrangling
We first clean the data and extract the relevant information. This involves merging the recipe dataset with the rating dataset (left merge) so that no rating/comment is without a recipe. Then, we rename a few columns to clarify their meaning. Next, we have to deal with comments that give a rating of zero. This is actually not technically a rating, but just a comment. Ratings are on a scale of 1 to 5, so 0 represents absence of a rating, and thus shouldn't be counted as a rating of 0 out of 5, but should be counted as missing (NaN). Now we can calculate the average rating of each recipe. This operation creates duplicate columns, which we immediately remove. Let's take a look at our dataset so far.

| name                                  |   minutes |   contributor_id | recipe_date   | tags                                                                                                                                                                                                                                                                                                                                    | nutrition                                    |   n_steps | steps                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | description                                                                                                                                                                                                                      | ingredients                                                                                                                            |   n_ingredients |   user_id |   recipe_id | review_date   | review                                                                                                                                                                                                                                                                                                                                                                                            |   rating |
|:--------------------------------------|----------:|-----------------:|:--------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------------------------------------------|----------:|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------|----------------:|----------:|------------:|:--------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------:|
| impossible macaroni and cheese pie    |        50 |           531768 | 2008-01-01    | ['60-minutes-or-less', 'time-to-make', 'course', 'main-ingredient', 'preparation', 'main-dish', 'eggs-dairy', 'pasta', 'easy', 'cheese', 'dietary', 'high-calcium', 'high-in-something', 'pasta-rice-and-grains', 'elbow-macaroni']                                                                                                     | [386.1, 34.0, 7.0, 24.0, 41.0, 62.0, 8.0]    |        11 | ['heat oven to 400 degrees fahrenheit', 'grease a pie plate 10 x 1 1 / 2 inches', 'mix 2 cups cheese and the macaroni', 'sprinkle mixture in the plate', 'beat remaining ingredients , except the 1 / 4 cup cheese , until smooth , 15 seconds in a blender on high , or 1 minute with a hand beater', 'pour into plate', 'bake until knife inserted in center comes out clean - about 40 minutes', 'sprinkle with 1 / 4 cup cheese', 'bake until cheese is melted , 1 to 2 minutes', 'cool 10 minutes', 'serves 6 to 8 people']                                                     | one of my mom's favorite bisquick recipes. this brings back memories!                                                                                                                                                            | ['cheddar cheese', 'macaroni', 'milk', 'eggs', 'bisquick', 'salt', 'red pepper sauce']                                                 |               7 |    240552 |      275022 | 2008-04-07    | Easy comfort food! I definitely thought it was impossible, but it worked. :D  I used 6 egg whites in place of the eggs and skim milk.  It came out super fluffy.  Thanks, Wendy!                                                                                                                                                                                                                  |        3 |
| impossible rhubarb pie                |        55 |           531768 | 2008-01-01    | ['60-minutes-or-less', 'time-to-make', 'course', 'preparation', 'healthy', 'pies-and-tarts', 'desserts', 'pies', 'dietary']                                                                                                                                                                                                             | [377.1, 18.0, 208.0, 13.0, 13.0, 30.0, 20.0] |         6 | ['heat oven to 375 degrees', 'grease 10" pan , put rhubarb in pan', 'blend all remaining ingredients for 3 minutes', 'pour over rhubarb', 'let set for a few minutes', 'bake 40 to 45 minutes']                                                                                                                                                                                                                                                                                                                                                                                      | a childhood favorite of mine. my mom loved it because it cut down on how much time to make it.                                                                                                                                   | ['rhubarb', 'eggs', 'bisquick', 'butter', 'salt', 'sugar', 'vanilla', 'milk']                                                          |               8 |    171303 |      275024 | 2009-05-26    | When I found myself needing a dessert and having rhubarb on hand this recipe fit the bill.  I did however find it to be too overly sweet.  I would try it again, using less  sugar.  Thank you Starfire for sharing the recipe.                                                                                                                                                                   |        3 |
| impossible seafood pie                |        45 |           531768 | 2008-01-01    | ['60-minutes-or-less', 'time-to-make', 'course', 'main-ingredient', 'preparation', 'very-low-carbs', 'main-dish', 'eggs-dairy', 'seafood', 'crab', 'cheese', 'dietary', 'low-sodium', 'low-calorie', 'low-carb', 'low-in-something', 'shellfish']                                                                                       | [326.6, 30.0, 12.0, 27.0, 37.0, 51.0, 5.0]   |         7 | ['preheat oven to 400f', 'lightly grease large pie plate', 'mix crabmeat , cheeses and onion in pie plate', 'mix remaining ingredients in blender until smooth', 'slowly pour liquid mixture into pie plate', 'bake until golden brown for 35 to 40 minutes', 'let stand 5 minutes before cutting']                                                                                                                                                                                                                                                                                  | this is an oldie but a goodie. mom's stand by for company. good enough for us on a special occasion or if company came over!                                                                                                     | ['frozen crabmeat', 'sharp cheddar cheese', 'cream cheese', 'onion', 'milk', 'bisquick', 'eggs', 'salt', 'nutmeg']                     |               9 |    558429 |      275026 | 2013-09-21    | Sorry, this one didn&#039;t work out so well. I did make some modifications that may have affected the taste of the recipe. I used imitation crabmeat, egg substitute, and fat free half-and-half. Unfortunately the end result was very bland--it definitely could have used some more spice. I really wanted to like this one but I won&#039;t be making this again. Thanks for posting anyway. |        3 |
| paula deen s caramel apple cheesecake |        45 |           666723 | 2008-01-01    | ['60-minutes-or-less', 'time-to-make', 'course', 'preparation', 'occasion', 'desserts', 'cheesecake', 'gifts', 'taste-mood', 'sweet']                                                                                                                                                                                                   | [577.7, 53.0, 149.0, 19.0, 14.0, 67.0, 21.0] |        11 | ['preheat oven to 350f', 'reserve 3 / 4 cup apple filling , and set aside', 'spoon remaining apple filling into the crust', 'beat together in large bowl , cream cheese , sugar , vanilla , eggs', 'pour over pie filling', 'bake for 35 minutes', 'cool', 'meanwhile , mix reserved pie filling and caramel topping and heat for 1 minute in a small saucepan', 'spread warm topping evenly over cooked , cooled cheesecake', 'decorate entire edge of cake with the 12 pecan halves , and sprinkle middle of cheesecake with chopped pecans', 'refrigerate , share , and enjoy !'] | thank you paula deen!  hubby just happened to be watching with me one day when she made these and it will always be requested in our home!  it's very easy to make and such a fun twist on a plain cheesecake.  it's a must try! | ['apple pie filling', 'graham cracker crust', 'cream cheese', 'sugar', 'vanilla', 'eggs', 'caramel topping', 'pecan halves', 'pecans'] |               9 |    156891 |      275030 | 2008-01-18    | This was the first cheesecake I'd ever made.  It turned out great.  I substituted wheat free, gluten free spice cookies for the crust.  Thanks for this delicious recipe.                                                                                                                                                                                                                         |        5 |
| midori poached pears                  |        25 |           307114 | 2008-01-01    | ['lactose', '30-minutes-or-less', 'time-to-make', 'course', 'main-ingredient', 'cuisine', 'preparation', 'occasion', 'south-west-pacific', 'desserts', 'fruit', 'australian', 'easy', 'beginner-cook', 'dinner-party', 'summer', 'dietary', 'gluten-free', 'seasonal', 'egg-free', 'free-of-something', 'pears', 'taste-mood', 'sweet'] | [386.9, 0.0, 347.0, 0.0, 1.0, 0.0, 33.0]     |         8 | ['bring midori , sugar , spices , rinds and water to the boil', 'simmer for 5 minutes', 'peel the pears and remove the base end but leave the stem intact', 'place pears in hot liquid and simmer for approximately 15mins or until cooked', 'cooking time depends on how ripe the pears are', 'place each pear on a dessert plate', 'top each pear with 2 tablespoons reserved poaching liquid', 'garnish with orange rind curls and mint sprigs']                                                                                                                                  | the green colour looks fabulous and the taste is heavenly. serve with a raspberry coulis. keep enough rind of the orange and lemon for garnish.                                                                                  | ['midori melon liqueur', 'water', 'caster sugar', 'cinnamon stick', 'vanilla pod', 'lemon rind', 'orange rind', 'pear', 'mint']        |               9 |    306797 |      275032 | 2008-03-21    | This needs at least 10 stars.  The recipe was easy to make & tasted magnificent.  I made a strawberry sauce that went wonderfully with it.  Thanks An_Net for sharing this keeper.                                                                                                                                                                                                                |        5 |

##### Data Extraction
Now that we have our single DataFrame, let's make the features of interest easily accessible. First, notice that the dates in the date column are strings, which is tedious to perform operations on. Instead, we convert all of the dates from string to datetime which makes them much easier to deal with later. Second, we also notice that columns like tags, nutrition, steps and ingredients look like lists, but are actually strings. This is also quite annoying to use in data analysis, so we convert those strings to lists in order to access their items easier. Since we know we'll want to investigate nutrition later, we separate each item in the list of nutrition facts into its own column, where each value is a float. Let's look at what the nutrition columns look like.



### Univariate Analysis

##### Ratings Histogram
Here we made a histogram of ratings to show the distribution. As you can see, it's quite skewed (left) since most recipes have only 5/5 reviews. We'll be careful in the future, remembering that this distribution is far from uniform or even normal.
<iframe src="plots/ratings_histogram.html" width=800 height=600 frameBorder=0></iframe>

##### Minutes Histogram
Originally, it would've been insightful to analyze a boxchart instead of histogram of recipe minutes since boxcharts display outliers more clearly. Unfortunately, some outliers are so large (over a million minutes!) that this ruins the visualization. Instead, we've removed times over 12 hours (less than 1% of recipes) in order to better understand the distribution of recipe times. Now that there are fewer outliers, it makes more sense to draw a histogram. This histogram is still quite skewed, so it seems most recipes take less than an hour to make, with a peak from around 20-40 minutes.
<iframe src="plots/minutes_histogram.html" width=800 height=600 frameBorder=0></iframe>



### Bivariate Analysis


##### Rating vs Number of Steps in Recipe
We can see many recipes along the integer intervals of the x axis since many recipes only have one or a couple reviews that are all the same. There is also a slight upward trend.
<iframe src="plots/scatter_nsteps_rating.html" width=800 height=600 frameBorder=0></iframe>

##### Rating vs Number of Calories in Recipe
We can see many recipes along the integer intervals of the x axis since many recipes only have one or a couple reviews that are all the same. There is also a slight upward trend.
<iframe src="plots/scatter_calories_rating.html" width=800 height=600 frameBorder=0></iframe>



### Analysis of Aggregated Data

##### Recipe Mintues over Time
Let's see how ratings have changed over the years the get a better sense of any time-related trends. Before analyzing the minutes per recipe, we first get rid of outliers. We define outliers as recipes that take more than 24 hours to make (less than 1% of all recipes). We initially look at a scatterplot of recipe minutes over time. This plot reveals not only that the number of recipes has decreased over time, but it looks as if the average minutes of the recipes also decreases over time. Notice the horizontal lines in the scatterplot, which is due to recipes rounding the number of minutes of their recipe to the nearest group of 10 or 30 minutes. The table below the plot shows that the number of recipes per year in fact decreases dramatically from 2008 to 2018.
<iframe src="plots/scatter_minutes_date.html" width=800 height=600 frameBorder=0></iframe>

##### Average Recipe Minutes per Year
print(aggregated.to_markdown(index=True))
Again, as you can see, the number of recipes per year in the dataset has greatly decreased since 2008. This is a little odd because overall production of content on the internet has grown over time. Perhaps the data somehow doesn't include all of the recipes. Before we investigate missingness, let's continue with aggregation investigation. When we aggregate the data by year, then a very different pattern emerges. Instead of a slow descent of recipe times over the years, we see most years have an average recipe time of 100 minutes except two years. This interesting aggregation shows that 2011 and 2016 were years with much higher average recipe times than any of their neighbors. Needless to say, the patterns of recipe times are hard to describe and even more difficult to predict.
<iframe src="plots/line_minutes_year.html" width=800 height=600 frameBorder=0></iframe>



### Assessment of Rating Missingness
There are 2 columns with more than 1 missing value, and the only column that's missing more than 100 values is the rating column. The rows that are missing rating are recipes that never got a comment/rating. Although we could easily argue that rating missingness is dependent on the number of comments (missing at random), we want to investigate further. Are there other features in our dataset that could influence the missingness of ratings? Specifically, is rating missingness dependent on nutrition? Perhaps recipes that are designed based on certain nutrition are less popular. This is reasonable since people often cook without thinking about nutrition facts like protein. Let's see if missingness of the recipe ratings depends on the percent daily value of protein in a recipe.

In order to test this theory, we will run a permutation test with 10,000 trials and a p-value of .05. If less than 5% of the trials in the permutation test contain test statistics equal to or greater than the observed test statistic, we can reject the null hypothesis.

##### Rating NMAR Test on Protein

Null hypothesis: the distribution of protein per recipe <u>without</u> a rating is the **same** as the distribution of the protein per recipe <u>with</u> a rating <br>

Alternative hypothesis: the distribution of protein per recipe <u>without</u> a rating is the **different** from the distribution of the protein per recipe <u>with</u> a rating <br>

Test statistic: the absolute difference between average protein per recipe including rating and protein per recipe missing rating.

Result: Our test yielded a p-value of .202, with which we fail to reject the null hypothesis. This means that we don't have sufficient evidence to dispute that rating missingness depends on protein in a recipe. Maybe rating missingness depends on a different nutrition fact. Since protein varies a lot less than ingredients like sugar in most recipes, this could've made it difficult to prove anything statistically significant. Now, let's run the same permutation test only with sugar (PDV) per recipe as our independent feature. 

##### Rating NMAR Test on Sugar

Null hypothesis: the distribution of sugar per recipe <u>without</u> a rating is the **same** as the distribution of the sugar per recipe <u>with</u> a rating <br>

Alternative hypothesis: the distribution of sugar per recipe <u>without</u> a rating is the **different** from the distribution of the sugar per recipe <u>with</u> a rating <br>

Test statistic: the absolute difference between average sugar per recipe including rating and sugar per recipe missing rating.

Result: This permutation test returned a p-value of approximately 0.0, which is certainly below our threshold of 0.05 and thus small enough to reject the null hypothesis. We can now infer that whether or not a recipe has a rating (rating missingness) is dependent on the percent daily value of sugar in the recipe. 











